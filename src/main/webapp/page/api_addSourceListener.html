<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<!-- saved from url=(0070)http://web.mit.edu/jhawk/mnt/spo/git/git-doc/technical/api-config.html -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
		<meta name="generator" content="AsciiDoc 8.6.9" />
		<title>ConfigCenter</title>
		<link rel="stylesheet" href="../css/style.css" type="text/css" />
		<script src="../js/main.js"></script>
		<style id="style-1-cropbar-clipper">/* Copyright 2014 Evernote Corporation. All rights reserved. */
			.en-markup-crop-options {
			    top: 18px !important;
			    left: 50% !important;
			    margin-left: -100px !important;
			    width: 200px !important;
			    border: 2px rgba(255,255,255,.38) solid !important;
			    border-radius: 4px !important;
			}
			
			.en-markup-crop-options div div:first-of-type {
			    margin-left: 0px !important;
			}
		</style>
	</head>
	<body class="article">
	<div id="header">
		<h1>配置资源监听器</h1>
	</div>
	<p align="right"><a href="../index.html">返回首页</a></p>
	<div id="content">
		<div id="preamble">
			<div class="sectionbody">
				<p>监听指定配置资源，当其发生变化时，执行自定义代码块，参数包括：</p>
				<div class="ulist">
				<ul>
					<li>
						<p>sourceName：监听的配置资源名称</p>
					</li>
					<li>
						<p>ievent：监听的配置资源发生变化时执行事件</p>
					</li>
				</ul>
			    </div>
				<div class="listingblock">
					<p>方法定义：</p>
					<div class="content">
						<dd><code>public void addSourceListener(String sourceName,IEvent ievent){...};</code></dd>
					</div>
				</div>
				<div class="paragraph">
					<p>如监听 redis 配置资源，当其发生变化后，自定义代码块完成获取最新ip，重建数据库连接功能，示例代码：<font color="red">（红色为需填入部分，其他为固定写法）</font></p>
				</div>
				<div class="listingblock">
					<div class="content">
						<dd><code>ConfigCenter.getInstance().addSourceListener("<font color="red">redis</font>",()-> {<br/><font color="red">
							&nbsp;&nbsp;&nbsp;&nbsp;System.out.println("检测redis集群信息变化，开始重建redis数据库连接...");<br/>
							&nbsp;&nbsp;&nbsp;&nbsp;String redisIp = ConfigCenter.getInstance().getDataSource("redis").getProperty("ip");<br/>
							&nbsp;&nbsp;&nbsp;&nbsp;...<br/></font>
							});
						</code></dd>
					</div>
				</div>
				<div class="paragraph">
					<p>可以对同一配置资源，定义多个监听器，另外一种client调用方法，示例代码：</p>
				</div>
				<div class="listingblock">
					<div class="content">
						<dd><code>IEvent <font color="red">ievent</font>=new IEvent() {<br/>
									&nbsp;&nbsp;&nbsp;&nbsp;@Override<br/>
									&nbsp;&nbsp;&nbsp;&nbsp;public void reload() {<br/><font color="red">
										&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println("检测redis集群信息变化，开始重建redis数据库连接...");<br/>
										&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String redisIp = ConfigCenter.getInstance().getDataSource("redis").getProperty("ip");<br/>
										&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...<br/></font>
									&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
								};<br/>
								ConfigCenter.getInstance().addSourceListener("<font color="red">redis</font>", <font color="red">ievent</font>);<br/>
						</code></dd>
					</div>
				</div>
			</div>
		</div>
	</div>

<div id="footer">
<div id="footer-text">
Last updated
 2017-08-30 17:38:58 EDT
</div>
</div>


</body></html>